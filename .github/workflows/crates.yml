name: crates
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - id: component
        uses: actions-rs/components-nightly@v1
        with:
          component: clippy
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: nightly
          override: true
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: wasm32-unknown-unknown
          override: true
      - name: push-crates
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          cargo +nightly install --git https://github.com/alexcrichton/wasm-gc --force
          cargo doc --all --all-features --no-deps
          cd target/release
          mkdir tmp
          git init
          git remote add origin https://satellitex:${GITHUB_TOKEN}@github.com/staketechnologies/Plasm.git
          git checkout gh-pages
          cp -R ../doc/* .
          git add .
          git commit -m 'auto update crates on gh-pages'
          git push origin gh-pages
